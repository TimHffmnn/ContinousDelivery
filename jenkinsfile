@Library('piper-lib-os') _


node(){
  stage('Prepare')   {
      deleteDir()
      checkout scm
      setupCommonPipelineEnvironment script:this
       // install Maven and add it to the path
    	env.PATH = "${tool 'M3'}/bin:${env.PATH}"

       configFileProvider([configFile(fileId: '1bb30f98-47ec-4073-a7b1-d914af4f5499', variable: 'MAVEN_SETTINGS')]){                                                                                   
        sh 'mvn -s $MAVEN_SETTINGS clean package'
    	}      
  }

  stage('Build')   {
      mtaBuild script:this      
  }

  stage('Deploy')   {
      cloudFoundryDeploy script:this, deployTool:'mtaDeployPlugin', verbose: true
  }
  
  stage ('publish') {
     nexusPublisher nexusInstanceId: 'localnexus', nexusRepositoryId: 'maven-releases', packages: [[$class: 'MavenPackage', mavenAssetList: [[classifier: '', extension: '', filePath: '/var/jenkins_home/workspace/CF_test/ci_test_project.mtar']], mavenCoordinate: [artifactId: 'jenkins-mtar', groupId: 'org.jenkins-CF.main', packaging: '.mtar', version: '2.001']]]
  }
 }